import { Meta } from '@storybook/blocks';

<Meta title="Design System/Dark Theme Guidelines" />

# Dark Theme Guidelines

Complete guide for implementing and maintaining dark mode in the User Management UI.

## Table of Contents

1. [Design Philosophy](#design-philosophy)
2. [Color Token System](#color-token-system)
3. [Implementation Patterns](#implementation-patterns)
4. [Accessibility Requirements](#accessibility-requirements)
5. [Best Practices](#best-practices)
6. [Testing Checklist](#testing-checklist)

---

## Design Philosophy

Our dark theme follows modern design principles:

- **WCAG 2.1 AA Compliant**: Minimum 4.5:1 contrast ratio for text
- **Semantic Colors**: Colors convey meaning and purpose
- **Consistent Hierarchy**: Visual hierarchy maintained across themes
- **Reduced Eye Strain**: Optimized for long reading sessions
- **System Integration**: Respects user's OS preference

### Core Principles

1. **Not Just Inverted**: Dark theme is carefully crafted, not a simple color inversion
2. **Elevated Surfaces**: Lighter backgrounds for elevated UI elements
3. **Reduced Pure Colors**: Desaturated colors to reduce eye strain
4. **Consistent Shadows**: Adapted shadow system for dark backgrounds

---

## Color Token System

### CSS Custom Properties

All colors are defined as CSS custom properties in `src/styles/dark-theme.css`.

#### Background Colors

```css
/* Surface Hierarchy */
--color-background-primary: #0a0a0a; /* Main background */
--color-background-secondary: #141414; /* Elevated surfaces */
--color-background-tertiary: #1a1a1a; /* Cards, panels */
--color-background-elevated: #1e1e1e; /* Modals, popovers */
--color-background-overlay: rgba(0, 0, 0, 0.8); /* Overlays */

/* Interactive Backgrounds */
--color-background-hover: #262626; /* Hover states */
--color-background-active: #2a2a2a; /* Active states */
--color-background-selected: #2d2d2d; /* Selected items */
```

#### Text Colors

```css
/* Text Hierarchy */
--color-text-primary: #e5e5e5; /* Main text (91% white) */
--color-text-secondary: #a3a3a3; /* Secondary text (64% white) */
--color-text-tertiary: #737373; /* Tertiary text (45% white) */
--color-text-disabled: #525252; /* Disabled text (32% white) */
--color-text-inverse: #0a0a0a; /* Text on light backgrounds */
```

#### Border Colors

```css
/* Borders */
--color-border-primary: #262626; /* Default borders */
--color-border-secondary: #333333; /* Subtle borders */
--color-border-focus: #3b82f6; /* Focus rings */
--color-border-error: #dc2626; /* Error states */
```

#### Semantic Colors

```css
/* Brand */
--color-primary: #3b82f6; /* Primary blue */
--color-primary-hover: #2563eb; /* Primary hover */
--color-primary-light: rgba(59, 130, 246, 0.1); /* Primary tint */

/* Success */
--color-success: #10b981; /* Success green */
--color-success-hover: #059669;
--color-success-light: rgba(16, 185, 129, 0.1);

/* Warning */
--color-warning: #f59e0b; /* Warning amber */
--color-warning-hover: #d97706;
--color-warning-light: rgba(245, 158, 11, 0.1);

/* Error */
--color-error: #ef4444; /* Error red */
--color-error-hover: #dc2626;
--color-error-light: rgba(239, 68, 68, 0.1);

/* Info */
--color-info: #06b6d4; /* Info cyan */
--color-info-hover: #0891b2;
--color-info-light: rgba(6, 182, 212, 0.1);
```

---

## Implementation Patterns

### Using Color Tokens

**✅ CORRECT - Using CSS Variables:**

```tsx
// In CSS
.button {
  background-color: var(--color-primary);
  color: var(--color-text-inverse);
  border: 1px solid var(--color-border-primary);
}

.button:hover {
  background-color: var(--color-primary-hover);
}
```

**❌ INCORRECT - Hardcoded Colors:**

```tsx
// Don't do this
.button {
  background-color: #3b82f6;
  color: white;
  border: 1px solid #262626;
}
```

### React Component Pattern

```tsx
import React from 'react';
import { useTheme } from '@contexts/ThemeContext';

export function ThemedComponent() {
  const { theme, isDark } = useTheme();

  return (
    <div className="themed-card">
      {/* Classes automatically adapt to dark mode */}
      <h2 className="text-primary">Title</h2>
      <p className="text-secondary">Description</p>
    </div>
  );
}
```

### Conditional Styling

When you need theme-specific logic:

```tsx
export function AdaptiveComponent() {
  const { isDark } = useTheme();

  return <div className={cn('card', isDark ? 'shadow-dark' : 'shadow-light')}>Content</div>;
}
```

---

## Accessibility Requirements

### Contrast Ratios

All text must meet WCAG 2.1 AA standards:

| Text Size                     | Minimum Contrast | Our Target |
| ----------------------------- | ---------------- | ---------- |
| Normal (< 18px)               | 4.5:1            | 7:1        |
| Large (≥ 18px or bold ≥ 14px) | 3:1              | 4.5:1      |
| UI Components                 | 3:1              | 4.5:1      |

### Testing Contrast

Use browser DevTools or online tools:

```bash
# Example contrast ratios in our dark theme:
Text Primary (#e5e5e5) on Background (#0a0a0a): 12.5:1 ✅
Text Secondary (#a3a3a3) on Background (#0a0a0a): 7.2:1 ✅
Text Tertiary (#737373) on Background (#0a0a0a): 4.6:1 ✅
```

### Focus Indicators

Focus rings must be visible in both themes:

```css
.interactive:focus-visible {
  outline: 2px solid var(--color-border-focus);
  outline-offset: 2px;
  /* Blue (#3b82f6) has 4.8:1 contrast on dark background */
}
```

---

## Best Practices

### 1. Always Use Design Tokens

```tsx
// ✅ Good
<div className="bg-primary text-inverse">

// ❌ Bad
<div style={{ backgroundColor: '#3b82f6', color: 'white' }}>
```

### 2. Test in Both Themes

Every component should be tested in both light and dark modes:

```tsx
// Use Storybook's theme switcher to test
export default {
  title: 'Components/MyComponent',
  component: MyComponent,
};
```

### 3. Consider Elevation

Elevated surfaces should be lighter in dark mode:

```css
/* Modal (elevated) */
.modal {
  background-color: var(--color-background-elevated); /* #1e1e1e */
}

/* Card (on surface) */
.card {
  background-color: var(--color-background-tertiary); /* #1a1a1a */
}

/* Page background */
.page {
  background-color: var(--color-background-primary); /* #0a0a0a */
}
```

### 4. Adapt Images and Icons

```tsx
// Use CSS filters for icons that need adaptation
.icon-adaptive {
  filter: brightness(0.9); /* Slightly dimmer in dark mode */
}

// Or use theme-aware icon colors
<Icon className="text-primary" />
```

### 5. Shadow Adaptation

Shadows need adjustment for dark backgrounds:

```css
/* Light theme */
.card-light {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* Dark theme */
.dark .card-light {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
  /* Darker and more prominent */
}
```

---

## Testing Checklist

### Visual Testing

- [ ] Component renders correctly in dark mode
- [ ] All text is readable (no pure black text)
- [ ] Icons are visible and appropriate
- [ ] Borders are visible but subtle
- [ ] Hover/active states are distinct
- [ ] Focus indicators are clear
- [ ] Images/media adapt appropriately

### Accessibility Testing

- [ ] Text contrast meets WCAG AA (4.5:1)
- [ ] Focus indicators are visible (3:1)
- [ ] Color is not the only indicator
- [ ] Screen reader compatibility maintained
- [ ] Keyboard navigation works in both themes

### Interaction Testing

- [ ] Hover states respond correctly
- [ ] Active/pressed states are clear
- [ ] Disabled states are distinguishable
- [ ] Loading states are visible
- [ ] Animations don't cause flashing

### Browser Testing

- [ ] Chrome/Edge (Chromium)
- [ ] Firefox
- [ ] Safari
- [ ] Mobile browsers

---

## Component Examples

### Button Component

```tsx
// Automatically adapts to dark mode
<Button variant="primary">Primary Action</Button>
<Button variant="secondary">Secondary Action</Button>
<Button variant="ghost">Ghost Button</Button>
```

### Alert Component

```tsx
// Semantic colors adapt automatically
<Alert variant="success">Operation successful</Alert>
<Alert variant="error">An error occurred</Alert>
<Alert variant="warning">Please review this</Alert>
<Alert variant="info">New information</Alert>
```

### Input Component

```tsx
// Form inputs with proper contrast
<Input
  label="Username"
  placeholder="Enter username"
  // Dark mode: white text on dark bg, visible border
/>
```

---

## Troubleshooting

### Issue: Text Not Visible

**Problem:** Text appears too dark on dark background

**Solution:**

```css
/* Ensure you're using text color tokens */
.text {
  color: var(--color-text-primary); /* Not #000 or #333 */
}
```

### Issue: Border Not Visible

**Problem:** Borders disappear in dark mode

**Solution:**

```css
.bordered {
  border: 1px solid var(--color-border-primary);
  /* Not transparent or rgba(0,0,0,...) */
}
```

### Issue: Poor Contrast

**Problem:** Component fails contrast ratio

**Solution:**

- Use lighter text colors (text-primary instead of text-tertiary)
- Increase border thickness for UI components
- Add subtle background tint for better separation

### Issue: Shadows Not Visible

**Problem:** Box shadows invisible in dark mode

**Solution:**

```css
.card {
  box-shadow:
    0 2px 8px rgba(0, 0, 0, 0.3),
    /* Darker shadow */ 0 0 0 1px var(--color-border-primary); /* Add subtle border */
}
```

---

## Migration Guide

### Converting Existing Components

1. **Identify hardcoded colors:**

   ```tsx
   // Find and replace
   backgroundColor: '#ffffff' → className="bg-primary"
   color: '#000000' → className="text-primary"
   borderColor: '#e5e5e5' → className="border-primary"
   ```

2. **Update CSS:**

   ```css
   /* Before */
   .component {
     background: white;
     color: black;
     border: 1px solid #ddd;
   }

   /* After */
   .component {
     background-color: var(--color-background-primary);
     color: var(--color-text-primary);
     border: 1px solid var(--color-border-primary);
   }
   ```

3. **Test thoroughly:**
   - Switch between themes in Storybook
   - Verify all states (hover, active, disabled)
   - Check contrast ratios
   - Test with real content

---

## Resources

### Internal Documentation

- **Theme Context:** `src/contexts/ThemeContext.tsx`
- **CSS Variables:** `src/styles/dark-theme.css`
- **Base Styles:** `src/styles/index-new.css`

### External Resources

- [WCAG 2.1 Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)
- [Contrast Checker](https://webaim.org/resources/contrastchecker/)
- [Material Design Dark Theme](https://material.io/design/color/dark-theme.html)

### Testing Tools

- **Chrome DevTools:** Rendering > Emulate CSS prefers-color-scheme
- **Firefox DevTools:** Similar theme emulation
- **Storybook:** Built-in theme switcher in toolbar

---

## Version History

- **v1.0** (Oct 2025): Initial dark theme implementation
  - 272-line CSS custom property system
  - Full component coverage
  - WCAG 2.1 AA compliant
  - React 19 optimized with useTransition

---

## Support

For questions or issues:

1. Check this documentation
2. Review component stories in Storybook
3. Examine `ThemeContext.tsx` implementation
4. Test with Storybook's theme switcher

**Pro Tip:** Use Storybook's "Docs" tab to see components in both themes side-by-side!
